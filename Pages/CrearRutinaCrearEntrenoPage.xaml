<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PulseTFG.Pages.CrearRutinaCrearEntrenoPage"
             xmlns:elem="clr-namespace:PulseTFG.Elementos"
             Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="False"
             BackgroundColor="{StaticResource FondoNegro}"
             FlyoutItem.IsVisible="True">

    <AbsoluteLayout>

        <!-- Contenido principal -->
        <Grid 
            RowDefinitions="*,4*,*" 
            ColumnDefinitions="*"
            AbsoluteLayout.LayoutBounds="0,0,1,1"
            AbsoluteLayout.LayoutFlags="All">

            <!-- Título -->
            <Label 
                Text="Creador Rutina" 
                TextColor="{StaticResource MoradoPrincipal}"
                FontFamily="AntonRegular"
                Grid.Row="0"
                VerticalOptions="Center"
                HorizontalOptions="Center"
                FontSize="40"
                FontAttributes="Italic"/>

            <!-- Cuerpo -->
            <Grid Grid.Row="1" RowDefinitions="Auto,Auto,Auto">
                <!-- Encabezado -->
                <HorizontalStackLayout Grid.Row="0" HorizontalOptions="Center" Spacing="10">
                    <Label Text="{Binding EntrenamientoActual.Nombre}" 
                           TextColor="{StaticResource MoradoPrincipal}"
                           FontFamily="AntonRegular"
                           FontSize="30"
                           FontAttributes="Italic"
                           VerticalOptions="Center"/>
                    <Button Text="✏️" Clicked="CambiarNombre_Clicked"
                            BackgroundColor="{StaticResource MoradoPrincipal}"
                            TextColor="White"
                            FontFamily="AntonRegular"
                            HorizontalOptions="Center"
                            FontSize="20"
                            VerticalOptions="Center"/>
                    <Button Text="Volver" Clicked="Volver_Clicked"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource RojoStop}"
                            FontSize="20"
                            VerticalOptions="Center"/>
                </HorizontalStackLayout>
                <HorizontalStackLayout Grid.Row="1" HorizontalOptions="Center">
                    
                    <!-- Botón Añadir -->
                    <Button Text="Añadir ejercicio"
                            VerticalOptions="End"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource MoradoPrincipal}"
                            Clicked="MostrarPopup_Clicked"/>
                    
                    <!--  Botón para resetear la lista  -->
                    <Button Text="Resetear lista"
                            VerticalOptions="End"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource NaranjaPausa}"
                            Clicked="ResetearLista_Clicked"/>
                </HorizontalStackLayout>

                <!-- Frame listado -->
                <Frame Grid.Row="2"
                       Margin="10"
                       BorderColor="{StaticResource MoradoPrincipal}"
                       BackgroundColor="{StaticResource FondoNegro}"
                       CornerRadius="15"
                       Padding="10"
                       WidthRequest="600"
                       VerticalOptions="FillAndExpand"
                       >

                    <CollectionView ItemsSource="{Binding EntrenamientoActual.TrabajoEsperado}" Margin="10" VerticalScrollBarVisibility="Always">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="20" />
                        </CollectionView.ItemsLayout>
                        
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid HorizontalOptions="CenterAndExpand" 
                                      ColumnDefinitions="200,*,*,*"
                                      ColumnSpacing="30">
                                    <Label Text="{Binding NombreEjercicio}" FontAttributes="Bold" FontSize="18" TextColor="White" VerticalOptions="Center"/>
                                    <Label Text="{Binding Series, StringFormat='Series: {0}'}" TextColor="White" Grid.Column="1" VerticalOptions="Center"/>
                                    <Label Text="{Binding Repeticiones, StringFormat='Reps: {0}'}" TextColor="White" Grid.Column="2" VerticalOptions="Center"/>
                                    <Button Text="🗑 Borrar"
                                            BackgroundColor="{StaticResource RojoStop}"
                                            TextColor="White"
                                            FontSize="14"
                                            Grid.Column="3"
                                            Clicked="BorrarTrabajoEsperado_Clicked"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Frame>
            </Grid>

            <!-- Menú Barra -->
            <elem:MenuBarra Grid.Row="2" IsVisible="{Binding TieneRutinas}"/>
        </Grid>

        <!-- Popup -->
        <Grid x:Name="PopupGrid"
              IsVisible="False"
              BackgroundColor="#AA000000"
              VerticalOptions="FillAndExpand"
              HorizontalOptions="FillAndExpand"
              RowSpacing="20"
              Padding="30"
              AbsoluteLayout.LayoutBounds="0,0,1,1"
              AbsoluteLayout.LayoutFlags="All"
              ZIndex="999">

            <Frame BackgroundColor="{StaticResource MoradoPrincipal}"
                   CornerRadius="20"
                   Padding="20"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   WidthRequest="400">

                <VerticalStackLayout Spacing="15" VerticalOptions="FillAndExpand">
                    <Label Text="Añadir ejercicio" FontSize="22" TextColor="{StaticResource AzulCian}" 
                           HorizontalOptions="CenterAndExpand"
                           VerticalOptions="CenterAndExpand"/>

                    <HorizontalStackLayout>
                        <Label Text="Grupo muscular:" FontSize="18" WidthRequest="150" FontAttributes="Bold"/>
                        <Picker x:Name="GrupoMuscularPicker" SelectedIndexChanged="GrupoMuscularPicker_SelectedIndexChanged" WidthRequest="100"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout>
                        <Label Text="Solo favoritos" FontSize="16" HorizontalOptions="Start" WidthRequest="150" FontAttributes="Bold"/>
                        <Switch x:Name="FavoritosSwitch" Toggled="FavoritosSwitch_Toggled" HorizontalOptions="End"/>
                    </HorizontalStackLayout>
                    
                    <HorizontalStackLayout>
                        <Label Text="Ejercicio:" FontSize="18" WidthRequest="150" FontAttributes="Bold"/>
                        <Picker x:Name="EjercicioPicker" ItemDisplayBinding="{Binding Nombre}" />
                    </HorizontalStackLayout>
                    
                    <HorizontalStackLayout>
                        <Label Text="Series:" FontSize="18" WidthRequest="150" FontAttributes="Bold"/>
                        <Label Text="{Binding Source={x:Reference SeriesStepper}, Path=Value}" FontSize="20" HorizontalOptions="Center" WidthRequest="50" VerticalOptions="Center"/>
                        <Stepper x:Name="SeriesStepper" Minimum="1" Maximum="20" Increment="1" Value="3" BackgroundColor="{StaticResource AzulCian}"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout>
                        <Label Text="Repeticiones:" FontSize="18" WidthRequest="150" FontAttributes="Bold"/>
                        <Label Text="{Binding Source={x:Reference RepeticionesStepper}, Path=Value}" FontSize="20" HorizontalOptions="Center" WidthRequest="50" VerticalOptions="Center"/>
                        <Stepper x:Name="RepeticionesStepper" Minimum="1" Maximum="50" Increment="1" Value="12" BackgroundColor="{StaticResource AzulCian}"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout HorizontalOptions="Center" Spacing="20">
                        <Button Text="Aceptar" Clicked="AceptarPopup_Clicked" BackgroundColor="{StaticResource VerdePlay}" TextColor="White" FontAttributes="Bold"/>
                        <Button Text="Cancelar" Clicked="CancelarPopup_Clicked" BackgroundColor="{StaticResource RojoStop}" TextColor="White" FontAttributes="Bold"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>

            </Frame>
        </Grid>

    </AbsoluteLayout>
</ContentPage>
